import streamlit as st

# ---------------------- ê¸°ë³¸ ì„¤ì • ----------------------
st.set_page_config(page_title="ê±´ê°• ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ", page_icon="ğŸƒ", layout="wide")

st.title("ğŸƒ ê±´ê°• ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ")
st.markdown("""
ì´ ì•±ì€ **BMI ê³„ì‚°ê¸°**, **ê¶Œì¥ ì¹¼ë¡œë¦¬ ì¶”ì²œ**, ê·¸ë¦¬ê³  **ì‹ìŠµê´€Â·ìš´ë™ ì¡°ì–¸ + ì•„ì¹¨/ì ì‹¬/ì €ë… ì‹ë‹¨ ì˜ˆì‹œ**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.  

### ğŸ“Œ BMIë€?
BMI(ì²´ì§ˆëŸ‰ì§€ìˆ˜, Body Mass Index)ëŠ” **ëª¸ë¬´ê²Œ(kg) Ã· [í‚¤(m)]Â²** ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.  
- **18.5 ë¯¸ë§Œ**: ì €ì²´ì¤‘  
- **18.5 ~ 24.9**: ì •ìƒ  
- **25 ~ 29.9**: ê³¼ì²´ì¤‘  
- **30 ì´ìƒ**: ë¹„ë§Œ  

BMIëŠ” ê±´ê°• ìƒíƒœë¥¼ ê°€ëŠ í•˜ëŠ” ì§€í‘œë¡œ í™œìš©ë©ë‹ˆë‹¤.
""")

# ---------------------- ìœ í‹¸ í•¨ìˆ˜ ----------------------
def make_meal_plan(category: str, calorie_needs: int):
    """BMI ì¹´í…Œê³ ë¦¬ì— ë”°ë¼ ê¸°ë³¸ ì‹ë‹¨ ì˜ˆì‹œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    calorie_needsì— ë§ì¶° íƒ„ë‹¨ì§€ ê· í˜•(ëŒ€ëµ)ì„ ê³ ë ¤í•´ ë¶„ëŸ‰ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.
    """
    # ë¶„ëŸ‰ ê°€ì´ë“œ (ëŒ€ëµ) â€” ì¹¼ë¡œë¦¬ì— ë”°ë¼ ê·¸ë¨/ì»µ ìˆ˜ë¥¼ ì¡°ì •
    if calorie_needs < 1700:
        portion = {
            "íƒ„ìˆ˜í™”ë¬¼": "ë°¥ 1ê³µê¸°(150g) ë˜ëŠ” í˜„ë¯¸Â·ì¡ê³¡ë°¥ 120g",
            "ë‹¨ë°±ì§ˆ": "ë‹­ê°€ìŠ´ì‚´/ë‘ë¶€/ë‹¬ê±€ 1~2ë‹¨ìœ„(ì˜ˆ: ë‹­ê°€ìŠ´ì‚´ 100g)",
            "ì±„ì†Œ": "ì±„ì†Œ 1~2ì»µ",
            "ì§€ë°©": "ê²¬ê³¼ë¥˜ í•œ ì¤Œ(15g) ë˜ëŠ” ì˜¬ë¦¬ë¸Œìœ  1ì‘ì€ìˆ "
        }
    elif calorie_needs < 2100:
        portion = {
            "íƒ„ìˆ˜í™”ë¬¼": "ë°¥ 1.3ê³µê¸°(180g) ë˜ëŠ” ê³ êµ¬ë§ˆ 200g",
            "ë‹¨ë°±ì§ˆ": "ì‚´ì½”ê¸°/ë‘ë¶€ 150g ë˜ëŠ” ë‹¬ê±€ 2ê°œ",
            "ì±„ì†Œ": "ì±„ì†Œ 2ì»µ ì´ìƒ",
            "ì§€ë°©": "ê²¬ê³¼ë¥˜ 20g ë˜ëŠ” ì˜¬ë¦¬ë¸Œìœ  1~2ì‘ì€ìˆ "
        }
    else:
        portion = {
            "íƒ„ìˆ˜í™”ë¬¼": "ë°¥ 1.5ê³µê¸°(220g) ë˜ëŠ” í†µê³¡ë¬¼ë¹µ 3ì¥",
            "ë‹¨ë°±ì§ˆ": "ì‚´ì½”ê¸°/ìƒì„  180~200g ë˜ëŠ” ë‹¬ê±€ 2~3ê°œ",
            "ì±„ì†Œ": "ì±„ì†Œ 2~3ì»µ",
            "ì§€ë°©": "ê²¬ê³¼ë¥˜ 25~30g ë˜ëŠ” ì˜¬ë¦¬ë¸Œìœ  2ì‘ì€ìˆ "
        }

    base = {
        "ì €ì²´ì¤‘": {
            "advice": "ì—ë„ˆì§€ ì„­ì·¨ë¥¼ ëŠ˜ë¦¬ê³  ê·œì¹™ì ìœ¼ë¡œ ê°„ì‹(ìš°ìœ Â·ë°”ë‚˜ë‚˜Â·ê²¬ê³¼ë¥˜)ì„ ì¶”ê°€í•˜ì„¸ìš”. ê·¼ë ¥ìš´ë™ ë³‘í–‰ìœ¼ë¡œ ê±´ê°•í•˜ê²Œ ì²´ì¤‘ì„ ëŠ˜ë¦¬ì„¸ìš”.",
            "breakfast": [
                "ê·¸ë¦­ìš”ê±°íŠ¸ + ê·¸ë˜ë†€ë¼ + ë°”ë‚˜ë‚˜",
                "ìŠ¤í¬ë¨ë¸” ì—ê·¸ + í†µê³¡ë¬¼ë¹µ 2ì¥",
                "ìš°ìœ  í•œ ì»µ(ë˜ëŠ” ë‘ìœ )"
            ],
            "lunch": [
                "í˜„ë¯¸ë°¥ + ë‹­ê°€ìŠ´ì‚´ 120g + ì•„ë³´ì¹´ë„ ìƒëŸ¬ë“œ",
                "ë‘ë¶€ê¹€ì¹˜(ê¸°ë¦„ ì ë‹¹íˆ) + ë‚˜ë¬¼ 2ì¢…"
            ],
            "dinner": [
                "ì—°ì–´êµ¬ì´ 150g + í†µê³¡ë¬¼ë°¥ + êµ¬ìš´ì•¼ì±„",
                "íŒŒìŠ¤íƒ€(ì˜¬ë¦¬ë¸Œì˜¤ì¼ ë² ì´ìŠ¤) + ë‹­ê°€ìŠ´ì‚´ 100g"
            ],
            "snack": ["ê²¬ê³¼ë¥˜ í•œ ì¤Œ", "ë°”ë‚˜ë‚˜/ì‚¬ê³¼", "ìš°ìœ /ë‘ìœ "]
        },
        "ì •ìƒ": {
            "advice": "í˜„ì¬ ì‹ìŠµê´€ì„ ìœ ì§€í•˜ë˜ ê°€ê³µì‹í’ˆÂ·ë‹¹ë¥˜ë¥¼ ì¤„ì´ê³ , ì£¼ 3~4íšŒ 30ë¶„ ë‚´ì™¸ ìœ ì‚°ì†Œ+ìŠ¤íŠ¸ë ˆì¹­ì„ ì¶”ì²œí•©ë‹ˆë‹¤.",
            "breakfast": [
                "ì˜¤íŠ¸ë°€ + ìš°ìœ  + ë¸”ë£¨ë² ë¦¬",
                "ë‹¬ê±€ 2ê°œ + í† ë§ˆí†  + í†µê³¡ë¬¼ë¹µ"
            ],
            "lunch": [
                "í˜„ë¯¸ë°¥ + ì œì² ì±„ì†Œ ë¹„ë¹” + ì‚¶ì€ê³„ë€",
                "ë©”ë°€ì†Œë°” + ë‹­ê°€ìŠ´ì‚´ ìƒëŸ¬ë“œ"
            ],
            "dinner": [
                "ìƒì„ êµ¬ì´ + ìƒëŸ¬ë“œ + ê³ êµ¬ë§ˆ",
                "ë‘ë¶€ìŠ¤í…Œì´í¬ + ì±„ì†Œë³¶ìŒ + í˜„ë¯¸ë°¥"
            ],
            "snack": ["í”Œë ˆì¸ ìš”ê±°íŠ¸", "ì‚¬ê³¼/ë°°", "ì•„ëª¬ë“œ ëª‡ ì•Œ"]
        },
        "ê³¼ì²´ì¤‘": {
            "advice": "ë‹¹ë¶„Â·íŠ€ê¹€Â·ì•¼ì‹ì„ ì¤„ì´ê³ , ë‹¨ë°±ì§ˆê³¼ ì±„ì†Œ ìœ„ì£¼ì˜ ì‹ë‹¨ìœ¼ë¡œ í¬ë§Œê°ì„ ë†’ì´ì„¸ìš”. ì£¼ 4~5íšŒ 30~40ë¶„ ìœ ì‚°ì†Œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.",
            "breakfast": [
                "ì‚¶ì€ ë‹¬ê±€ 2ê°œ + ë°©ìš¸í† ë§ˆí†  + í†µê³¡ë¬¼ë¹µ 1ì¥",
                "ì €ì§€ë°© ìš”ê±°íŠ¸ + ë² ë¦¬ë¥˜ + ê²¬ê³¼ ì†ŒëŸ‰"
            ],
            "lunch": [
                "ë‹­ê°€ìŠ´ì‚´ ìƒëŸ¬ë“œ(ì˜¬ë¦¬ë¸Œìœ  ì†ŒëŸ‰) + í†µê³¡ë¬¼ë¹µ 1ì¥",
                "ê³¤ì•½/ë‘ë¶€ë©´ ìƒëŸ¬ë“œ + ê³¼ì¼ ì†ŒëŸ‰"
            ],
            "dinner": [
                "í˜„ë¯¸ë°¥ ì†ŒëŸ‰ + ë‹´ë°±í•œ êµ­(ë§‘ì€íƒ•) + ì±„ì†Œë°˜ì°¬ 2~3ì¢…",
                "êµ¬ìš´ ìƒì„ /ì‚´ì½”ê¸° 120g + ìƒëŸ¬ë“œ + ê³ êµ¬ë§ˆ ì†ŒëŸ‰"
            ],
            "snack": ["ë°©ìš¸í† ë§ˆí† ", "ì˜¤ì´/ë‹¹ê·¼ìŠ¤í‹±", "ì•„ëª¬ë“œ ì†ŒëŸ‰"]
        },
        "ë¹„ë§Œ": {
            "advice": "ì¹¼ë¡œë¦¬ ë°€ë„ ë‚®ì€ ì‹í’ˆ(ì±„ì†ŒÂ·í•´ì¡°ë¥˜Â·ë²„ì„¯) ìœ„ì£¼ë¡œ ë“œì‹œê³ , ì„¤íƒ•Â·ê°€ê³µìŒë£Œë¥¼ í”¼í•˜ì„¸ìš”. ì˜ì‚¬Â·ì˜ì–‘ì‚¬ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
            "breakfast": [
                "ì±„ì†Œ ì˜¤ë¯ˆë › + í†µê³¡ë¬¼ë¹µ 1ì¥",
                "ê·¸ë¦­ìš”ê±°íŠ¸(ë¬´ê°€ë‹¹) + ë² ë¦¬ë¥˜"
            ],
            "lunch": [
                "í˜„ë¯¸ë°¥ ì†ŒëŸ‰ + ë‹­ê°€ìŠ´ì‚´ 120g + ì±„ì†Œë¬´ì¹¨ 2ì¢…",
                "ì—°ë‘ë¶€ + ìƒëŸ¬ë“œ + ì‚¶ì€ê³„ë€ 1ê°œ"
            ],
            "dinner": [
                "êµ¬ìš´ ìƒì„  120g + ì±„ì†Œìˆ˜í”„ + ìƒëŸ¬ë“œ",
                "ë‘ë¶€Â·ë²„ì„¯ ë³¶ìŒ + ì±„ì†Œ ê°€ë“ ë¹„ë¹”"
            ],
            "snack": ["ë¬´ê°€ë‹¹ ì°¨/ì•„ë©”ë¦¬ì¹´ë…¸", "ì˜¤ì´/ì…€ëŸ¬ë¦¬", "ì•„ëª¬ë“œ 10~15ì•Œ"]
        }
    }

    plan = base.get(category, base["ì •ìƒ"])  # ê¸°ë³¸ì€ ì •ìƒí˜•

    # ë¶„ëŸ‰ ì•ˆë‚´ ë¬¸êµ¬ ìƒì„±
    portion_text = " | ".join([f"{k}: {v}" for k, v in portion.items()])

    return plan, portion_text

# ---------------------- ì‚¬ìš©ì ì…ë ¥ ----------------------
st.sidebar.header("ê°œì¸ ì •ë³´ ì…ë ¥")
name = st.sidebar.text_input("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”", "í™ê¸¸ë™")
age = st.sidebar.number_input("ë‚˜ì´", min_value=10, max_value=100, value=20)
gender = st.sidebar.selectbox("ì„±ë³„", ["ë‚¨ì„±", "ì—¬ì„±"])
height = st.sidebar.number_input("í‚¤(cm)", min_value=100, max_value=220, value=170)
weight = st.sidebar.number_input("ëª¸ë¬´ê²Œ(kg)", min_value=30, max_value=150, value=65)
activity_level = st.sidebar.selectbox(
    "í™œë™ ìˆ˜ì¤€",
    ["ê±°ì˜ ìš´ë™ ì•ˆ í•¨", "ê°€ë²¼ìš´ í™œë™", "ë³´í†µ í™œë™", "ì ê·¹ì ì¸ í™œë™", "ìš´ë™ì„ ìˆ˜ ìˆ˜ì¤€"]
)

# ---------------------- ë²„íŠ¼ í´ë¦­ ì‹œ ê²°ê³¼ ê³„ì‚° ----------------------
if st.sidebar.button("ê²°ê³¼ í™•ì¸í•˜ê¸°"):
    # BMI ê³„ì‚°
    height_m = height / 100
    bmi = round(weight / (height_m ** 2), 2) if height_m > 0 else 0

    if bmi < 18.5:
        bmi_status = "ì €ì²´ì¤‘"
        bmi_color = "ğŸ”µ"
        card_color = "#cce5ff"
    elif 18.5 <= bmi < 25:
        bmi_status = "ì •ìƒ"
        bmi_color = "ğŸŸ¢"
        card_color = "#d4edda"
    elif 25 <= bmi < 30:
        bmi_status = "ê³¼ì²´ì¤‘"
        bmi_color = "ğŸŸ "
        card_color = "#fff3cd"
    else:
        bmi_status = "ë¹„ë§Œ"
        bmi_color = "ğŸ”´"
        card_color = "#f8d7da"

    # ê¶Œì¥ ì¹¼ë¡œë¦¬ ê³„ì‚°
    if gender == "ë‚¨ì„±":
        bmr = 66.47 + (13.75 * weight) + (5.003 * height) - (6.755 * age)
    else:
        bmr = 655.1 + (9.563 * weight) + (1.850 * height) - (4.676 * age)

    activity_multipliers = {
        "ê±°ì˜ ìš´ë™ ì•ˆ í•¨": 1.2,
        "ê°€ë²¼ìš´ í™œë™": 1.375,
        "ë³´í†µ í™œë™": 1.55,
        "ì ê·¹ì ì¸ í™œë™": 1.725,
        "ìš´ë™ì„ ìˆ˜ ìˆ˜ì¤€": 1.9,
    }

    calorie_needs = round(bmr * activity_multipliers.get(activity_level, 1.2))

    # ì‹ë‹¨ ê³„íš ìƒì„±
    meal_plan, portion_text = make_meal_plan(bmi_status, calorie_needs)

    # ë©”ì¸ ì¹´ë“œ: BMI & ì¹¼ë¡œë¦¬
    st.markdown(f"""
    <div style="background-color:{card_color}; padding:20px; border-radius:10px;">
      <h3>ğŸ’¡ {name}ë‹˜ì˜ ê±´ê°• ì§€í‘œ</h3>
      <p><b>BMI:</b> {bmi} {bmi_color} ({bmi_status})</p>
      <p><b>ê¶Œì¥ ì¹¼ë¡œë¦¬:</b> {calorie_needs} kcal</p>
    </div>
    """, unsafe_allow_html=True)

    # ì‹ë‹¨ ì¹´ë“œ
    st.markdown(f"""
    <div style="background-color:#f1f1f1; padding:20px; border-radius:10px; margin-top:20px;">
      <h3>ğŸ¥— ì•„ì¹¨/ì ì‹¬/ì €ë… ì‹ë‹¨ ì˜ˆì‹œ</h3>
      <p style="margin-bottom:8px;"><b>ë¶„ëŸ‰ ê°€ì´ë“œ:</b> {portion_text}</p>
      <h4>ğŸ³ ì•„ì¹¨</h4>
      <ul>{''.join([f'<li>{item}</li>' for item in meal_plan['breakfast']])}</ul>
      <h4>ğŸ± ì ì‹¬</h4>
      <ul>{''.join([f'<li>{item}</li>' for item in meal_plan['lunch']])}</ul>
      <h4>ğŸ½ï¸ ì €ë…</h4>
      <ul>{''.join([f'<li>{item}</li>' for item in meal_plan['dinner']])}</ul>
      <h4>ğŸ ê°„ì‹(ì„ íƒ)</h4>
      <ul>{''.join([f'<li>{item}</li>' for item in meal_plan['snack']])}</ul>
    </div>
    """, unsafe_allow_html=True)

    # ì¡°ì–¸ ì¹´ë“œ
    st.markdown(f"""
    <div style="background-color:#eef6ff; padding:20px; border-radius:10px; margin-top:20px;">
      <h3>ğŸ’¬ ë§ì¶¤ ì¡°ì–¸</h3>
      <p>{meal_plan['advice']}</p>
      <p style="font-size:13px; color:#555;">*ê°œì¸ë³„ ê±´ê°• ìƒíƒœì— ë”°ë¼ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•„ìš” ì‹œ ì „ë¬¸ê°€ì™€ ìƒë‹´í•˜ì„¸ìš”.</p>
    </div>
    """, unsafe_allow_html=True)
